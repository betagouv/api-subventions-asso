<%- include('../partials/header') -%>
<main role="main" id="contenu">
    <div class="fr-container fr-mb-8w">
        <%- include('../partials/ariane', { items: [
                { label: 'Accueil', url: '/' },
                { label: 'Changement de mot de passe' },
            ],})
            -%>
            <div class="fr-grid-row fr-grid-row--center fr-grid-row--gutters">
                <div class="fr-col fr-col-lg-8">
                    <% if (activation) { %>
                        <h1>Activer mon compte en créent mon mot de passe</h1>
                    <% } else { %>
                        <h1>Modifier votre mot de passe</h1>
                    <% }%>
                    <% if (typeof error != 'undefined' && error) { %>
                        <div role="alert" class="fr-alert fr-alert--warning">
                            <p class="fr-alert__title">Attention</p>
                            <p>Format du mot de passe incorrect</p>
                        </div>
                    <% } %>
                    <div role="alert" class="fr-alert fr-alert--info">
                        <p class="fr-alert__title">Format du mot de passe</p>
                        <ul>
                            <li>Doit contenir au moins un chiffre [0-9]</li>
                            <li>Doit contenir au moins un caractère minuscule [a-z]</li>
                            <li>Doit contenir au moins un caractère majuscule [A-Z]</li>
                            <li>Doit contenir au moins un caractère spécial [*.!@#$%^&(){}[]:;<>,.?/~_+-=|\\]</li>
                            <li>Doit contenir au moins 8 caractères, mais pas plus de 32</li>
                        </ul>
                    </div>
                    <form action="" method="POST" data-controller="resetPassword">
                        <fieldset class="fr-fieldset fr-my-4w">
                            <div class="fr-input-group">
                                <label class="fr-label" for="text-input-text">Mot de passe :</label>
                                <input class="fr-input" type="password" name="password" required="true" data-resetPassword-target="password" data-action="input->resetPassword#valueChange">
                            </div>
                            <div class="fr-input-group">
                                <input class="fr-input" type="hidden" name="token" required="true" value="<%-token%>">
                            </div>
                        </fieldset>
                        <div class="fr-input-group fr-my-4w">
                            <button type="submit" class="fr-btn" title="Réserver ma conférence" data-resetPassword-target="submit" disabled="true">Valider</button>
                        </div>
                    </form>
            </div>
        </div>
    </div>
</main>
<%- include('../partials/footer') -%>


<script type="module">
    import { Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"

        Stimulus.register("resetPassword", class extends Controller {
            static targets = ["password", "submit"];

            passwordRegex = /^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[*.!@$%^&(){}[\]:;<>,.?/~_+=|-]).{8,32}$/;
            valueChange() {
                const value = this.passwordTarget.value;
                if (this.passwordRegex.test(value)) {
                    this.submitTarget.removeAttribute("disabled");
                } else {
                    this.submitTarget.setAttribute("disabled", "true");
                }
            }
        })
</script>