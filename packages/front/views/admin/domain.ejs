<%- include('../header') -%>
<main role="main" id="contenu">
    <div class="fr-container fr-mb-8w">
        <%- include('../global_components/ariane', { items: [
                { label: 'Accueil', url: '/' },
                { label: 'Admin', url: "/admin" },
                { label: 'Nom de domaines' },
            ],})
            -%>
            <div class="fr-grid-row fr-grid-row--center fr-grid-row--gutters">
                <% const domainNames = Object.keys(usersByDomainName).sort((a,b) => usersByDomainName[b].length - usersByDomainName[a].length); %>

                <div class="fr-col-12 fr-col-md-12">
                    <h2>Liste des noms de domaines :</h2>
                    <ul class="admin-domain-ul">
                        <% for( let index = 0; index < domainNames.length; index++ ) { %>
                            <% const domainName = domainNames[index]; %>
                            <% const users = usersByDomainName[domainName]; %>

                            <li>
                                <a href="#<%= domainName %>"><%= domainName.replace("@", '') %> - <%= users.length %> utilisateurs</a>
                            </li>
                        <%}%>
                    </ul>
                </div>

                <div class="fr-col-12 fr-col-md-12">
                    <h2>DÃ©tail pour chaque nom de domaine :</h2>
                </div>
                <% for( let index = 0; index < domainNames.length; index++ ) { %>
                    <% const domainName = domainNames[index]; %>
                    <% const users = usersByDomainName[domainName]; %>
                    <div class="fr-col-12 fr-col-md-6" id="<%= domainName %>">
                        <h3> <%- domainName %> </h3>
                        <p>Nombre d'utilisateurs : <%= users.length %></p>
                        <p>Nombre d'utilisateurs ayant activer leurs comptes : <%= users.filter(u => u.active).length %></p>

                        <div class="fr-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th scope="col">Email</th>
                                        <th scope="col">Roles</th>
                                        <th scope="col">Actif</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for(let i = users.length -1 ; i >= 0; i-- ) { %>
                                        <% const user = users[i];%> 
                                        <tr>
                                            <td><%-user.email%></td>
                                            <td><%-user.roles.join(" - ")%></td>
                                            <td><%-user.active ? "Oui" : "Non"%></td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</main>
<%- include('../footer') -%>