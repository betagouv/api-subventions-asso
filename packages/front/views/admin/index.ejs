<%- include('../header') -%>
<main role="main" id="contenu">
    <div class="fr-container fr-mb-8w">
        <%- include('../global_components/ariane', { items: [
                { label: 'Accueil', url: '/' },
                { label: 'Admin' },
            ],})
            -%>
            <div class="fr-grid-row fr-grid-row--center fr-grid-row--gutters">
                <div class="fr-col fr-col-lg-12">
                    <h1>Admin</h1>

                    <% if (typeof error != 'undefined' && error) { %>
                        <% if (error == "USER_EMAIL_NOT_FOUND") { %>
                            <div role="alert" class="fr-alert fr-alert--warning">
                                <p>Nous n'avons pas réussi à récupérer l'email</p>
                            </div>
                        <% } else { %>
                            <div role="alert" class="fr-alert fr-alert--warning">
                                <p>Une erreur est survenue ! Contactez les devs !</p>
                            </div>
                        <% } %>
                    <% } %>

                    <% if (typeof success != 'undefined' && success) { %>
                        <div role="alert" class="fr-alert fr-alert--success">
                            <p>L'utilisateur à bien été inscrit</p>
                        </div>
                    <% } %>

                    <form action="/admin/user/create" method="POST" data-turbo="false">
                        <fieldset class="fr-fieldset fr-my-4w">
                            <legend class="fr-fieldset__legend" id='text-legend'>Créer un utilisateur</legend>
                            <div class="fr-input-group">
                                <label class="fr-label" for="text-input-text">Email :</label>
                                <input class="fr-input" type="email" name="email" required="true">
                            </div>
                        </fieldset>
                        <div class="fr-input-group fr-my-4w">
                            <button type="submit" class="fr-btn" title="Inscrire l'utilisateur">Envoyer</button>
                        </div>
                    </form>

                    <div class="fr-table">
                        <table>
                            <caption>Users</caption>
                            <thead>
                                <tr>
                                    <th scope="col">Email</th>
                                    <th scope="col">Roles</th>
                                    <th scope="col">Actif</th>
                                    <th scope="col">Reset link</th>
                                    <th scope="col">Date du token de reset</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for(let i = 0; i < users.length; i++ ) { %>
                                    <% const user = users[i];%> 
                                    <tr>
                                        <td><%-user.email%></td>
                                        <td><%-user.roles.join(" - ")%></td>
                                        <td><%-user.active ? "Oui" : "Non"%></td>
                                        <td>
                                            <% if (user.resetToken) { %>
                                                <a href="/auth/reset-password/<%-user.resetToken%>">/auth/reset-password/<%-user.resetToken%></a>
                                            <% } %>
                                        </td>
                                        <td><%-user.resetTokenDate%></td>
                                    </tr>
                                <% } %>
                            </tbody>
                        </table>
                </div>
            </div>
        </div>
    </div>
</main>
<%- include('../footer') -%>